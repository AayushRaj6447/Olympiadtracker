
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Olympiad Book Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; color: #333; }
    h1, h2 { text-align: center; }
    .controls, .summary, .navigation, .export, .manual-nav { text-align: center; margin: 20px 0; }
    .subjects button, .navigation button, .manual-nav select { margin: 5px; padding: 10px 20px; font-size: 16px; }
    .summary pre { text-align: left; background: #fff; padding: 10px; border: 1px solid #ccc; border-radius: 5px; overflow-x: auto; max-height: 300px; }
  </style>
</head>
<body>
  <h1>Olympiad Book Tracker</h1>

  <div class="manual-nav">
    <label for="classSelect">Class:</label>
    <select id="classSelect" onchange="resetStudentIndex(); updateCurrentStudent();">
      <option>I</option><option>II</option><option>III</option><option>IV</option><option>V</option>
      <option>VI</option><option>VII</option><option>VIII</option><option>IX</option><option>X</option>
    </select>

    <label for="studentSelect">Student No:</label>
    <select id="studentSelect" onchange="updateCurrentStudent();">
    </select>
  </div>

  <div class="navigation">
    <h2>Current Student: <span id="currentStudent">I_1</span></h2>
    <button onclick="prevStudent()">‚¨ÖÔ∏è Previous</button>
    <button onclick="nextStudent()">Next ‚û°Ô∏è</button>
  </div>

  <div class="controls">
    <div class="subjects">
      <button onclick="addBook('GK')">GK</button>
      <button onclick="addBook('English')">English</button>
      <button onclick="addBook('Science')">Science</button>
      <button onclick="addBook('Maths')">Maths</button>
      <button onclick="addBook('Computer')">Computer</button>
      <button onclick="addBook('Social')">Social</button>
      <button onclick="addBook('Hindi')">Hindi</button>
      <button onclick="addBook('Reasoning')">Reasoning</button>
      <button onclick="addBook('None')">‚ùå No Books</button>
    </div>
    <div>
      <button onclick="undoLast()">‚Ü©Ô∏è Undo</button>
      <button onclick="resetStudent()">‚ôªÔ∏è Reset Student</button>
    </div>
  </div>

  <div class="summary">
    <h2>üìä Live Summary</h2>
    <pre id="summaryBox">No data yet.</pre>
  </div>

  <div class="export">
    <button onclick="downloadExcel()">‚¨áÔ∏è Download Excel</button>
  </div>

  <script>
    const prices = { Reasoning: 250, None: 0 };
    const allSubjects = ["GK", "English", "Science", "Maths", "Computer", "Social", "Hindi", "Reasoning"];
    let currentClass = "I";
    let currentIndex = 1;
    const maxStudents = 50;

    const data = JSON.parse(localStorage.getItem("olympiadData") || "{}");

    function getStudentId() {
      return currentClass + "_" + currentIndex;
    }

    function saveData() {
      localStorage.setItem("olympiadData", JSON.stringify(data));
    }

    function updateCurrentStudent() {
      currentClass = document.getElementById("classSelect").value;
      currentIndex = parseInt(document.getElementById("studentSelect").value);
      document.getElementById("currentStudent").innerText = getStudentId();
      updateSummary();
    }

    function resetStudentIndex() {
      document.getElementById("studentSelect").value = 1;
      currentIndex = 1;
    }

    function addBook(subject) {
      const id = getStudentId();
      if (!data[id]) data[id] = [];
      if (subject === "None") {
        data[id] = [];
      } else if (!data[id].includes(subject)) {
        data[id].push(subject);
      }
      saveData();
      updateSummary();
    }

    function undoLast() {
      const id = getStudentId();
      if (data[id] && data[id].length > 0) {
        data[id].pop();
        saveData();
        updateSummary();
      }
    }

    function resetStudent() {
      const id = getStudentId();
      delete data[id];
      saveData();
      updateSummary();
    }

    function prevStudent() {
      if (currentIndex > 1) {
        currentIndex--;
        document.getElementById("studentSelect").value = currentIndex;
        updateCurrentStudent();
      }
    }

    function nextStudent() {
      if (currentIndex < maxStudents) {
        currentIndex++;
        document.getElementById("studentSelect").value = currentIndex;
        updateCurrentStudent();
      }
    }

    function updateSummary() {
      let text = "";
      let totals = { form: 0, books: 0, total: 0 };
      let subjectCounts = {};
      let classTotals = {};

      for (let cls of ["I","II","III","IV","V","VI","VII","VIII","IX","X"]) {
        classTotals[cls] = { count: 0, books: 0, total: 0 };
      }

      Object.entries(data).forEach(([id, books]) => {
        const cls = id.split("_")[0];
        const studentTotal = books.reduce((sum, book) => sum + (prices[book] || 100), 0);
        text += `${id}: ${books.join(", ") || "No books"} | ‚Çπ${studentTotal + 150} (Books ‚Çπ${studentTotal} + Form ‚Çπ150)
`;
        classTotals[cls].count++;
        classTotals[cls].books += studentTotal;
        classTotals[cls].total += studentTotal + 150;
        books.forEach(book => {
          subjectCounts[book] = (subjectCounts[book] || 0) + 1;
        });
      });

      text += "
üìö Subject-wise Totals:
";
      for (let sub of allSubjects) {
        const count = subjectCounts[sub] || 0;
        const price = prices[sub] || 100;
        text += `${sub}: ${count} √ó ‚Çπ${price} = ‚Çπ${count * price}
`;
        totals.books += count * price;
      }

      text += "
üè´ Class-wise Totals:
";
      for (let [cls, val] of Object.entries(classTotals)) {
        if (val.count > 0) {
          text += `${cls}: ${val.count} forms | Books ‚Çπ${val.books} | Total ‚Çπ${val.total}
`;
        }
      }

      totals.form = Object.keys(data).length * 150;
      totals.total = totals.books + totals.form;

      text += `
üí∞ Grand Total:
Books: ‚Çπ${totals.books}
Forms: ‚Çπ${totals.form}
Total: ‚Çπ${totals.total}`;

      document.getElementById("summaryBox").innerText = text || "No data yet.";
    }

    function downloadExcel() {
      let csv = "Class,Student ID,Book,Price\n";
      Object.entries(data).forEach(([id, books]) => {
        const cls = id.split("_")[0];
        if (books.length === 0) {
          csv += `${cls},${id},No books,‚Çπ0\n`;
        } else {
          books.forEach(book => {
            const price = prices[book] || 100;
            csv += `${cls},${id},${book},‚Çπ${price}\n`;
          });
        }
        csv += `${cls},${id},Form,‚Çπ150\n`;
      });

      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "Olympiad_Book_Report.csv";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    window.onload = function () {
      let select = document.getElementById("studentSelect");
      for (let i = 1; i <= maxStudents; i++) {
        let opt = document.createElement("option");
        opt.value = i;
        opt.text = i;
        select.appendChild(opt);
      }
      updateCurrentStudent();
    };
  </script>
</body>
</html>
