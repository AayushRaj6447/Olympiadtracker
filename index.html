<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Olympiad Book Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 15px;
      background-color: #f9f9f9;
    }
    h2 {
      margin-bottom: 5px;
    }
    .button-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 10px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    button.active {
      background-color: #4CAF50;
      color: white;
    }
    #summary, #totals {
      margin-top: 15px;
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
    }
    .nav-buttons {
      margin-top: 10px;
    }
    .nav-buttons button {
      margin-right: 5px;
    }
    select {
      padding: 5px;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <h2>üìò Olympiad Book Tracker</h2>
  <div>
    <b>Class:</b>
    <select id="classSelector" onchange="changeClass(this.value)">
      <option value="0">I</option>
      <option value="1">II</option>
      <option value="2">III</option>
      <option value="3">IV</option>
      <option value="4">V</option>
      <option value="5">VI</option>
      <option value="6">VII</option>
      <option value="7">VIII</option>
      <option value="8">IX</option>
      <option value="9">X</option>
    </select>

    &nbsp;&nbsp;

    <b>Student ID:</b>
    <select id="studentSelector" onchange="changeStudent(this.value)">
      <!-- Populated by JS -->
    </select>
  </div>

  <div class="button-grid" id="subjectButtons"></div>

  <div class="nav-buttons">
    <button onclick="prevStudent()">‚¨ÖÔ∏è Prev</button>
    <button onclick="nextStudent()">‚û°Ô∏è Next</button>
    <button onclick="resetStudent()">üóëÔ∏è Reset This Student</button>
    <button onclick="resetAll()">‚ùå Reset All</button>
    <button onclick="downloadExcel()">üì• Export Excel</button>
  </div>

  <div id="summary"></div>
  <div id="totals"></div>

  <script>
    const classes = ["I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX", "X"];
    const maxStudentsPerClass = 30;
    const subjects = ["GK", "English", "Science", "Maths", "Computer", "Social Studies", "Hindi", "Reasoning"];
    const subjectPrices = {
      "GK": 100, "English": 100, "Science": 100, "Maths": 100,
      "Computer": 100, "Social Studies": 100, "Hindi": 100, "Reasoning": 250
    };
    const formPrice = 150;

    let currentClassIndex = 0;
    let currentStudentIndex = 0;
    let data = JSON.parse(localStorage.getItem('olympiadData')) || {};

    function getStudentID() {
      return `${classes[currentClassIndex]}_${currentStudentIndex + 1}`;
    }

    function renderStudentSelector() {
      const sel = document.getElementById("studentSelector");
      sel.innerHTML = "";
      for (let i = 1; i <= maxStudentsPerClass; i++) {
        const opt = document.createElement("option");
        opt.value = i - 1;
        opt.textContent = i;
        sel.appendChild(opt);
      }
      sel.value = currentStudentIndex;
    }

    function renderButtons() {
      const container = document.getElementById('subjectButtons');
      container.innerHTML = "";
      subjects.forEach(subject => {
        const btn = document.createElement('button');
        btn.textContent = subject;
        btn.onclick = () => toggleSubject(subject);
        if (data[getStudentID()]?.includes(subject)) {
          btn.classList.add("active");
        }
        container.appendChild(btn);
      });
    }

    function toggleSubject(subject) {
      const id = getStudentID();
      data[id] = data[id] || [];
      if (data[id].includes(subject)) {
        data[id] = data[id].filter(s => s !== subject);
      } else {
        data[id].push(subject);
      }
      localStorage.setItem('olympiadData', JSON.stringify(data));
      renderButtons();
      renderSummary();
      renderTotals();
    }

    function renderSummary() {
      const id = getStudentID();
      const books = data[id] || [];
      let bookTotal = books.reduce((sum, sub) => sum + subjectPrices[sub], 0);
      const fullTotal = bookTotal + formPrice;

      document.getElementById("summary").innerHTML = `
        <b>Selected Subjects:</b> ${books.join(", ") || "None"}<br>
        <b>Book Price:</b> ‚Çπ${bookTotal} | <b>Form Price:</b> ‚Çπ${formPrice}<br>
        <b>Total for ${id}:</b> ‚Çπ${fullTotal}
      `;
    }

    function renderTotals() {
      let totalBooks = 0, totalReasoning = 0, totalForms = 0, grandTotal = 0;
      let classBookCount = {}, subjectCount = {};
      classes.forEach(cls => classBookCount[cls] = 0);
      subjects.forEach(sub => subjectCount[sub] = 0);

      Object.keys(data).forEach(id => {
        const [cls, num] = id.split("_");
        const subs = data[id];
        if (!subs || subs.length === 0) return;
        classBookCount[cls] += subs.length;
        totalForms++;
        subs.forEach(sub => {
          subjectCount[sub]++;
          grandTotal += subjectPrices[sub];
        });
      });

      grandTotal += totalForms * formPrice;

      let report = `<b>üìä Overall Totals:</b><br>`;
      report += `<b>Total Forms:</b> ${totalForms} (‚Çπ${totalForms * formPrice})<br>`;
      report += `<b>Total Books:</b> ${Object.values(subjectCount).reduce((a,b)=>a+b,0)} (‚Çπ${grandTotal - totalForms * formPrice})<br>`;
      report += `<b>Grand Total:</b> ‚Çπ${grandTotal}<br><br>`;

      report += `<b>Subjects Ordered:</b><br>`;
      subjects.forEach(s => report += `${s}: ${subjectCount[s]}<br>`);

      report += `<br><b>Class-wise Book Count:</b><br>`;
      classes.forEach(c => report += `${c}: ${classBookCount[c]}<br>`);

      document.getElementById("totals").innerHTML = report;
    }

    function nextStudent() {
      if (currentStudentIndex < maxStudentsPerClass - 1) {
        currentStudentIndex++;
      } else if (currentClassIndex < classes.length - 1) {
        currentClassIndex++;
        currentStudentIndex = 0;
      }
      refresh();
    }

    function prevStudent() {
      if (currentStudentIndex > 0) {
        currentStudentIndex--;
      } else if (currentClassIndex > 0) {
        currentClassIndex--;
        currentStudentIndex = maxStudentsPerClass - 1;
      }
      refresh();
    }

    function resetStudent() {
      const id = getStudentID();
      delete data[id];
      localStorage.setItem('olympiadData', JSON.stringify(data));
      refresh();
    }

    function resetAll() {
      if (confirm("Are you sure you want to delete ALL data?")) {
        localStorage.removeItem('olympiadData');
        data = {};
        refresh();
      }
    }

    function changeClass(index) {
      currentClassIndex = parseInt(index);
      refresh();
    }

    function changeStudent(index) {
      currentStudentIndex = parseInt(index);
      refresh();
    }

    function refresh() {
      document.getElementById("classSelector").value = currentClassIndex;
      document.getElementById("studentSelector").value = currentStudentIndex;
      renderStudentSelector();
      renderButtons();
      renderSummary();
      renderTotals();
    }

    function downloadExcel() {
      let csv = "Student ID,Class,Subjects,Books Cost,Form Cost,Total\n";
      Object.keys(data).forEach(id => {
        const subs = data[id] || [];
        const cls = id.split("_")[0];
        const bookTotal = subs.reduce((sum, s) => sum + subjectPrices[s], 0);
        const total = bookTotal + formPrice;
        csv += `${id},${cls},"${subs.join(", ")}",${bookTotal},${formPrice},${total}\n`;
      });

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "Olympiad_Book_Orders.csv";
      a.click();
      URL.revokeObjectURL(url);
    }

    // Init on load
    refresh();
  </script>
</body>
</html>