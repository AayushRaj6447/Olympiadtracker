<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Olympiad Book Tracker</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    button { margin: 5px; padding: 10px 15px; font-size: 16px; }
    .selected { background-color: lightgreen; }
    #summary, #classSubjectSummary { margin-top: 30px; white-space: pre; font-family: monospace; background: #f4f4f4; padding: 15px; border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h2>Olympiad Book Order Tracker</h2>

  <label for="classSelect">Select Class:</label>
  <select id="classSelect">
    <option>I</option><option>II</option><option>III</option><option>IV</option><option>V</option>
    <option>VI</option><option>VII</option><option>VIII</option><option>IX</option><option>X</option>
  </select>
  <br><br>

  <div>
    <button onclick="prevStudent()">‚èÆ Previous</button>
    <span id="studentIdDisplay">I_1</span>
    <button onclick="nextStudent()">Next ‚è≠</button>
  </div>

  <h3>Select Subjects</h3>
  <div id="subjects">
    <button onclick="toggleSubject('GK')">GK</button>
    <button onclick="toggleSubject('English')">English</button>
    <button onclick="toggleSubject('Science')">Science</button>
    <button onclick="toggleSubject('Maths')">Maths</button>
    <button onclick="toggleSubject('Computer')">Computer</button>
    <button onclick="toggleSubject('Social Studies')">Social Studies</button>
    <button onclick="toggleSubject('Hindi')">Hindi</button>
    <button onclick="toggleSubject('Reasoning')">Reasoning</button>
  </div>

  <br>
  <button onclick="clearStudent()">‚ùå Clear This Student</button>
  <button onclick="resetAll()">üîÅ Reset All</button>
  <button onclick="downloadExcel()">üì• Download Excel</button>

  <div id="summary"></div>
  <div id="classSubjectSummary"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    const subjects = ["GK", "English", "Science", "Maths", "Computer", "Social Studies", "Hindi", "Reasoning"];
    let currentClass = "I";
    let currentIndex = 1;
    let data = JSON.parse(localStorage.getItem("olympiadData") || "{}");

    const studentIdDisplay = document.getElementById("studentIdDisplay");
    const classSelect = document.getElementById("classSelect");
    const subjectButtons = document.querySelectorAll("#subjects button");
    const summaryDiv = document.getElementById("summary");
    const classSummaryDiv = document.getElementById("classSubjectSummary");

    classSelect.addEventListener("change", () => {
      currentClass = classSelect.value;
      currentIndex = 1;
      updateStudentDisplay();
    });

    function updateStudentDisplay() {
      const id = `${currentClass}_${currentIndex}`;
      studentIdDisplay.textContent = id;
      updateSubjectButtons();
      updateSummary();
    }

    function getCurrentID() {
      return `${currentClass}_${currentIndex}`;
    }

    function toggleSubject(subject) {
      const id = getCurrentID();
      data[id] = data[id] || [];
      if (data[id].includes(subject)) {
        data[id] = data[id].filter(s => s !== subject);
      } else {
        data[id].push(subject);
      }
      localStorage.setItem("olympiadData", JSON.stringify(data));
      updateSubjectButtons();
      updateSummary();
    }

    function updateSubjectButtons() {
      const id = getCurrentID();
      const selected = data[id] || [];
      subjectButtons.forEach(btn => {
        if (selected.includes(btn.textContent)) {
          btn.classList.add("selected");
        } else {
          btn.classList.remove("selected");
        }
      });
    }

    function prevStudent() {
      if (currentIndex > 1) {
        currentIndex--;
        updateStudentDisplay();
      }
    }

    function nextStudent() {
      if (currentIndex < 150) {
        currentIndex++;
        updateStudentDisplay();
      }
    }

    function clearStudent() {
      const id = getCurrentID();
      delete data[id];
      localStorage.setItem("olympiadData", JSON.stringify(data));
      updateSubjectButtons();
      updateSummary();
    }

    function resetAll() {
      if (confirm("Are you sure you want to delete all data?")) {
        data = {};
        localStorage.removeItem("olympiadData");
        updateStudentDisplay();
        updateSummary();
      }
    }

    function updateSummary() {
      let totalBooks = 0, totalReasoning = 0, totalForms = 0, totalAmount = 0;
      const subjectCounts = {}, classWise = {};

      for (let id in data) {
        const cls = id.split("_")[0];
        classWise[cls] = classWise[cls] || {};
        totalForms++;
        data[id].forEach(sub => {
          const price = sub === "Reasoning" ? 250 : 100;
          totalAmount += price;
          totalBooks++;
          if (sub === "Reasoning") totalReasoning++;
          subjectCounts[sub] = (subjectCounts[sub] || 0) + 1;
          classWise[cls][sub] = (classWise[cls][sub] || 0) + 1;
        });
      }

      summaryDiv.innerHTML =
        `üìò Total Books: ${totalBooks}\n` +
        `üß† Reasoning Books: ${totalReasoning}\n` +
        `üìÑ Total Forms: ${totalForms}\n` +
        `üí∞ Total Book Amount: ‚Çπ${totalAmount}\n` +
        `üßæ Total Form Amount: ‚Çπ${totalForms * 150}\n` +
        `üíµ Grand Total: ‚Çπ${totalAmount + totalForms * 150}\n` +
        `\nüìä Subject-wise Counts:\n` +
        subjects.map(s => `${s.padEnd(15)}: ${subjectCounts[s] || 0}`).join("\n");

      classSummaryDiv.innerHTML = `üìö Class-wise Subject Distribution:\n\n`;

      for (let cls in classWise) {
        classSummaryDiv.innerHTML += `Class ${cls}:\n`;
        subjects.forEach(s => {
          classSummaryDiv.innerHTML += `  ${s.padEnd(15)}: ${classWise[cls][s] || 0}\n`;
        });
        classSummaryDiv.innerHTML += "\n";
      }
    }

    function downloadExcel() {
      const rows = [["Student ID", "Class", "Subjects", "Books Amount", "Form Amount", "Total"]];
      for (let id in data) {
        const cls = id.split("_")[0];
        const subjectsList = data[id];
        const bookAmt = subjectsList.reduce((sum, sub) => sum + (sub === "Reasoning" ? 250 : 100), 0);
        const total = bookAmt + 150;
        rows.push([id, cls, subjectsList.join(", "), bookAmt, 150, total]);
      }

      const ws = XLSX.utils.aoa_to_sheet(rows);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Orders");
      XLSX.writeFile(wb, "Olympiad_Book_Orders.xlsx");
    }

    // Init
    updateStudentDisplay();
  </script>
</body>
</html>