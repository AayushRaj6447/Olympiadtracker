<!DOCTYPE html>
<html>
<head>
    <title>Olympiad Tracker</title>
    <style>
        body { font-family: Arial; display: flex; gap: 20px; }
        .panel { border: 1px solid #ccc; padding: 10px; width: 300px; }
        .summary-table { border-collapse: collapse; width: 100%; }
        .summary-table th, .summary-table td { border: 1px solid #ccc; padding: 4px; text-align: center; }
    </style>
</head>
<body>

<div class="panel">
    <h3>Student Entry</h3>
    <label>Class:
        <select id="classSelect">
            <option value="1">Class 1</option>
            <option value="2">Class 2</option>
            <option value="3">Class 3</option>
            <option value="4">Class 4</option>
            <option value="5">Class 5</option>
            <option value="6">Class 6</option>
            <option value="7">Class 7</option>
            <option value="8">Class 8</option>
            <option value="9">Class 9</option>
            <option value="10">Class 10</option>
        </select>
    </label>
    <br><br>
    <label>Section:</label><br>
    <label><input type="radio" name="section" value="A">A</label>
    <label><input type="radio" name="section" value="B">B</label>
    <label><input type="radio" name="section" value="C">C</label>
    <label><input type="radio" name="section" value="D">D</label>
    <label><input type="radio" name="section" value="E">E</label>
    <br><br>
    <label>Roll Number: <input type="number" id="rollNumber"></label>
    <br><br>

    <strong>Exams (₹150 each)</strong><br>
    <label><input type="checkbox" data-type="exam" value="GK">GK</label>
    <label><input type="checkbox" data-type="exam" value="English">English</label>
    <label><input type="checkbox" data-type="exam" value="Science">Science</label>
    <label><input type="checkbox" data-type="exam" value="Maths">Maths</label>
    <label><input type="checkbox" data-type="exam" value="Computer">Computer</label>
    <label><input type="checkbox" data-type="exam" value="Social Studies">Social Studies</label>
    <label><input type="checkbox" data-type="exam" value="Hindi">Hindi</label>
    <label><input type="checkbox" data-type="exam" value="Reasoning">Reasoning</label>
    <br><br>

    <strong>Books</strong><br>
    <label><input type="checkbox" data-type="book" value="GK">GK</label>
    <label><input type="checkbox" data-type="book" value="English">English</label>
    <label><input type="checkbox" data-type="book" value="Science">Science</label>
    <label><input type="checkbox" data-type="book" value="Maths">Maths</label>
    <label><input type="checkbox" data-type="book" value="Computer">Computer</label>
    <label><input type="checkbox" data-type="book" value="Social Studies">Social Studies</label>
    <label><input type="checkbox" data-type="book" value="Hindi">Hindi</label>
    <label><input type="checkbox" data-type="book" value="Reasoning">Reasoning</label>
    <br><br>

    <button onclick="saveStudent()">Save Student</button>
    <button onclick="prevStudent()">Previous</button>
    <button onclick="nextStudent()">Next</button>
    <button onclick="exportExcel()">Export</button>
</div>

<div class="panel">
    <h3>Live Summary</h3>
    <div id="summary"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
<script>
let data = JSON.parse(localStorage.getItem("olympiadData") || "{}");
let currentClass = "1", currentIndex = 0;
const subjects = ["GK","English","Science","Maths","Computer","Social Studies","Hindi","Reasoning"];

document.getElementById("classSelect").addEventListener("change", e=>{
    currentClass = e.target.value;
    currentIndex = 0;
    loadStudent();
});

function saveStudent(){
    if(!data[currentClass]) data[currentClass] = [];
    const section = document.querySelector('input[name="section"]:checked')?.value || "";
    const rollNumber = document.getElementById("rollNumber").value || "";
    const exams = [...document.querySelectorAll('input[data-type="exam"]:checked')].map(c=>c.value);
    const books = [...document.querySelectorAll('input[data-type="book"]:checked')].map(c=>c.value);
    data[currentClass][currentIndex] = {section, rollNumber, exams, books};
    localStorage.setItem("olympiadData", JSON.stringify(data));
    updateSummary();
}

function loadStudent(){
    const record = data[currentClass]?.[currentIndex] || {};
    document.querySelectorAll('input[name="section"]').forEach(r=>r.checked = (r.value===record.section));
    document.getElementById("rollNumber").value = record.rollNumber || "";
    document.querySelectorAll('input[data-type="exam"]').forEach(c=>c.checked = record.exams?.includes(c.value) || false);
    document.querySelectorAll('input[data-type="book"]').forEach(c=>c.checked = record.books?.includes(c.value) || false);
}

function prevStudent(){
    if(currentIndex>0){ currentIndex--; loadStudent(); }
}
function nextStudent(){
    currentIndex++;
    loadStudent();
}

function updateSummary(){
    let html = "<table class='summary-table'><tr><th>Class</th>";
    subjects.forEach(s=>html += `<th>${s} Books</th>`);
    html += "</tr>";
    for(let cls=1; cls<=10; cls++){
        html += `<tr><td>${cls}</td>`;
        subjects.forEach(sub=>{
            let count = (data[cls]||[]).filter(stu=>stu.books?.includes(sub)).length;
            html += `<td>${count}</td>`;
        });
        html += "</tr>";
    }
    html += "</table>";
    document.getElementById("summary").innerHTML = html;
}
updateSummary();

function exportExcel(){
    let exportData = [];
    for(let cls=1; cls<=10; cls++){
        (data[cls]||[]).forEach((stu,i)=>{
            exportData.push({
                Class: cls,
                Section: stu.section || "",
                RollNumber: stu.rollNumber || "",
                Exams: stu.exams?.join(", ") || "",
                Books: stu.books?.join(", ") || ""
            });
        });
    }
    const ws = XLSX.utils.json_to_sheet(exportData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Olympiad");
    XLSX.writeFile(wb, "Olympiad_Data.xlsx");
}

document.addEventListener("keydown", e=>{
    if(e.target.tagName === "INPUT") return; // don't hijack typing in roll number

    // Exam shortcuts (1–8)
    if(e.key >= "1" && e.key <= "8"){
        const idx = parseInt(e.key)-1;
        const cb = document.querySelectorAll('input[data-type="exam"]')[idx];
        cb.checked = !cb.checked;
        saveStudent();
    }
    // Book shortcuts (Q–I for books)
    const bookKeys = ["q","w","e","r","t","y","u","i"];
    if(bookKeys.includes(e.key.toLowerCase())){
        const idx = bookKeys.indexOf(e.key.toLowerCase());
        const cb = document.querySelectorAll('input[data-type="book"]')[idx];
        cb.checked = !cb.checked;
        saveStudent();
    }
    // Section shortcuts (A–E keys z,x,c,v,b)
    const sectionKeys = ["z","x","c","v","b"];
    if(sectionKeys.includes(e.key.toLowerCase())){
        const idx = sectionKeys.indexOf(e.key.toLowerCase());
        document.querySelectorAll('input[name="section"]')[idx].checked = true;
        saveStudent();
    }
    // Navigation
    if(e.key === "ArrowRight") nextStudent();
    if(e.key === "ArrowLeft") prevStudent();
});
</script>

</body>
</html>