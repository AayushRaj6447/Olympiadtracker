<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Olympiad Tracker</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
button { margin: 5px; padding: 5px 10px; }
.active { background-color: #4CAF50; color: white; }
.container { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 15px; }
h2 { margin-top: 0; }
input[type="number"] { width: 80px; padding: 5px; }
.summary { margin-top: 20px; }
table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
</style>
</head>
<body>

<h2>Olympiad Tracking System</h2>

<label>Select Class:</label>
<select id="classSelect">
  <option value="1">Class 1</option>
  <option value="2">Class 2</option>
  <option value="3">Class 3</option>
  <option value="4">Class 4</option>
  <option value="5">Class 5</option>
  <option value="6">Class 6</option>
  <option value="7">Class 7</option>
  <option value="8">Class 8</option>
  <option value="9">Class 9</option>
  <option value="10">Class 10</option>
</select>

<div>
  <label>Section:</label>
  <div class="container" id="sectionButtons">
    <button data-section="A">A</button>
    <button data-section="B">B</button>
    <button data-section="C">C</button>
    <button data-section="D">D</button>
    <button data-section="E">E</button>
  </div>
</div>

<div>
  <label>Roll No:</label>
  <input type="number" id="rollNumber" placeholder="Roll No">
</div>

<h3>Exams (₹150 each):</h3>
<div class="container" id="examButtons">
  <button data-exam="GK">GK (1)</button>
  <button data-exam="English">English (2)</button>
  <button data-exam="Science">Science (3)</button>
  <button data-exam="Maths">Maths (4)</button>
  <button data-exam="Computer">Computer (5)</button>
  <button data-exam="Social">Social Studies (6)</button>
  <button data-exam="Hindi">Hindi (7)</button>
  <button data-exam="Reasoning">Reasoning (8)</button>
</div>

<h3>Books:</h3>
<div class="container" id="bookButtons">
  <button data-book="GK">GK (Q)</button>
  <button data-book="English">English (W)</button>
  <button data-book="Science">Science (E)</button>
  <button data-book="Maths">Maths (R)</button>
  <button data-book="Computer">Computer (T)</button>
  <button data-book="Social">Social Studies (Y)</button>
  <button data-book="Hindi">Hindi (U)</button>
  <button data-book="Reasoning">Reasoning (O)</button>
</div>

<div>
  <button id="prevBtn">← Previous</button>
  <button id="nextBtn">Next →</button>
  <button id="exportBtn">Export to Excel</button>
</div>

<div class="summary">
  <h3>Live Summary</h3>
  <div id="summary"></div>
</div>

<script>
let maxStudents = 250;
let subjects = ["GK","English","Science","Maths","Computer","Social","Hindi","Reasoning"];
let data = JSON.parse(localStorage.getItem("olympiadData")) || {};
let currentClass = "1";
let currentStudent = 1;
let currentSection = "";

document.getElementById("classSelect").addEventListener("change", e => {
  currentClass = e.target.value;
  currentStudent = 1;
  loadStudent();
});

document.querySelectorAll("#sectionButtons button").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.querySelectorAll("#sectionButtons button").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    currentSection = btn.dataset.section;
    saveStudent();
  });
});

document.querySelectorAll("#examButtons button").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    btn.classList.toggle("active");
    saveStudent();
  });
});

document.querySelectorAll("#bookButtons button").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    btn.classList.toggle("active");
    saveStudent();
  });
});

document.getElementById("rollNumber").addEventListener("input", saveStudent);

document.getElementById("prevBtn").addEventListener("click", ()=>{
  if(currentStudent>1){ currentStudent--; loadStudent(); }
});
document.getElementById("nextBtn").addEventListener("click", ()=>{
  if(currentStudent<maxStudents){ currentStudent++; loadStudent(); }
});

function saveStudent(){
  if(!data[currentClass]) data[currentClass] = {};
  data[currentClass][currentStudent] = {
    section: currentSection,
    roll: document.getElementById("rollNumber").value,
    exams: Array.from(document.querySelectorAll("#examButtons .active")).map(b=>b.dataset.exam),
    books: Array.from(document.querySelectorAll("#bookButtons .active")).map(b=>b.dataset.book)
  };
  localStorage.setItem("olympiadData", JSON.stringify(data));
  updateSummary();
}

function loadStudent(){
  document.querySelectorAll("#examButtons button, #bookButtons button, #sectionButtons button")
    .forEach(b=>b.classList.remove("active"));
  document.getElementById("rollNumber").value = "";
  currentSection = "";
  let student = data[currentClass]?.[currentStudent];
  if(student){
    document.getElementById("rollNumber").value = student.roll || "";
    if(student.section){
      currentSection = student.section;
      document.querySelector(`#sectionButtons button[data-section='${student.section}']`)?.classList.add("active");
    }
    student.exams?.forEach(ex=>{
      document.querySelector(`#examButtons button[data-exam='${ex}']`)?.classList.add("active");
    });
    student.books?.forEach(book=>{
      document.querySelector(`#bookButtons button[data-book='${book}']`)?.classList.add("active");
    });
  }
  updateSummary();
}

function updateSummary(){
  let summaryHTML = "";
  for(let cls in data){
    let totalForms = 0, totalRevenue = 0;
    for(let s in data[cls]){
      let exams = data[cls][s].exams?.length || 0;
      totalForms += exams;
      totalRevenue += exams * 150;
    }
    summaryHTML += `<p>Class ${cls}: ${totalForms} exams, ₹${totalRevenue}</p>`;
  }
  document.getElementById("summary").innerHTML = summaryHTML;
}

document.addEventListener("keydown", e=>{
  let key = e.key.toUpperCase();
  if(!isNaN(parseInt(key)) && key >= "1" && key <= "8"){
    document.querySelector(`#examButtons button:nth-child(${key})`)?.click();
  }
  let bookKeys = {Q:0,W:1,E:2,R:3,T:4,Y:5,U:6,O:7};
  if(bookKeys[key] !== undefined){
    document.querySelector(`#bookButtons button:nth-child(${bookKeys[key]+1})`)?.click();
  }
  let sectionKeys = {Z:"A",X:"B",C:"C",V:"D",B:"E"};
  if(sectionKeys[key]){
    document.querySelector(`#sectionButtons button[data-section='${sectionKeys[key]}']`)?.click();
  }
  if(e.key === "ArrowRight") document.getElementById("nextBtn").click();
  if(e.key === "ArrowLeft") document.getElementById("prevBtn").click();
  if(!isNaN(parseInt(key)) && e.target.tagName !== "INPUT" && !(key >= "1" && key <= "8")){
    document.getElementById("rollNumber").value += key;
    saveStudent();
  }
});

document.getElementById("exportBtn").addEventListener("click", ()=>{
  let rows = [["Class","Student No","Section","Roll","Exams","Books","Total Cost"]];
  for(let cls in data){
    for(let s in data[cls]){
      let st = data[cls][s];
      let cost = (st.exams?.length || 0) * 150;
      rows.push([cls, s, st.section || "", st.roll || "", (st.exams||[]).join(", "), (st.books||[]).join(", "), cost]);
    }
  }
  let csv = rows.map(r=>r.join(",")).join("\n");
  let blob = new Blob([csv], { type: "text/csv" });
  let url = URL.createObjectURL(blob);
  let a = document.createElement("a");
  a.href = url;
  a.download = "olympiad_data.csv";
  a.click();
});
loadStudent();
</script>
</body>
</html>